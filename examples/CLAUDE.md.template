# {YOUR_PROJECT_NAME}

**Last Updated**: {DATE}
**codeindex Version**: v0.7.0+

---

## üìö Code Intelligence Tools

This project uses **codeindex** for code structure analysis and optional integration with **LoomGraph** for semantic code search.

---

## üîç codeindex - AST Code Analysis

### Installation

```bash
pip install ai-codeindex
```

### Quick Start

```bash
# Generate human-readable documentation (Markdown)
codeindex scan-all

# Generate machine-readable data (JSON) for tool integration
codeindex scan-all --output json > parse_results.json

# Scan a specific directory
codeindex scan ./src --output json
```

### Configuration

Create `.codeindex.yaml` in project root:

```yaml
# Include directories to scan
include:
  - src
  - lib

# Exclude directories
exclude:
  - tests
  - node_modules
  - "**/migrations/*"
  - "**/__pycache__/*"

# Output file name (for Markdown mode)
output_file: README_AI.md

# Languages to parse (currently only Python supported)
languages:
  - python
```

### Output Modes

**Markdown Mode** (default):
- Generates `README_AI.md` in each directory
- Human-readable documentation
- Includes symbols, imports, and structure
- Best for: Browsing and understanding code

**JSON Mode** (`--output json`):
- Outputs structured data to stdout
- Machine-readable format
- Includes symbols, calls, inheritances, imports
- Best for: Tool integration, automation, AI agents

---

## üß† LoomGraph - Code Knowledge Graph (Optional)

If your project uses LoomGraph for semantic code search and graph-based analysis:

### Installation

```bash
pip install loomgraph
```

### Quick Start

```bash
# 1. Index codebase (one-time or when code changes)
codeindex scan-all --output json > parse_results.json
loomgraph embed parse_results.json --output embeddings.json
loomgraph inject parse_results.json embeddings.json

# Or use one-line command
loomgraph index .

# 2. Search code semantically
loomgraph search "user authentication logic"

# 3. Query call graph
loomgraph graph "UserService.login" --direction callers

# 4. Check system status
loomgraph status
```

### Configuration

Create `loomgraph.yaml` in project root:

```yaml
database:
  host: localhost
  port: 5432
  database: loomgraph
  user: loomgraph
  password: loomgraph_dev

embedding:
  provider: jina
  model: jinaai/jina-embeddings-v2-base-code
  base_url: http://localhost:8080
  batch_size: 32

retrieval:
  default_mode: hybrid  # hybrid, semantic, keyword, graph
  top_k: 10
```

---

## ü§ñ AI Agent Usage Guide

### For Claude Code / AI Agents

When working with this codebase, you should:

#### 1. Understand Project Structure

**Start with README_AI.md files**:
```bash
# These files are generated by codeindex and provide:
# - Directory overview
# - Symbol lists (classes, functions, methods)
# - Import analysis
# - File structure
```

**Read hierarchy**:
1. `/README_AI.md` - Project overview
2. `/src/README_AI.md` - Main source structure
3. `/src/{module}/README_AI.md` - Module details

#### 2. Find Symbol Definitions

**Use PROJECT_SYMBOLS.md** (if exists):
- Global symbol index
- Quick lookup for classes and functions
- Cross-file references

**Use codeindex JSON output**:
```bash
# Find all classes
codeindex scan-all --output json | jq '.results[].symbols[] | select(.kind == "class")'

# Find specific symbol
codeindex scan-all --output json | jq '.results[].symbols[] | select(.name == "UserService")'
```

#### 3. Analyze Code Relationships

**Extract call graph**:
```bash
codeindex scan-all --output json | jq '.results[].calls[]'
```

**Find who calls a function** (if LoomGraph available):
```bash
loomgraph graph "UserService.login" --direction callers
```

#### 4. Semantic Search (if LoomGraph available)

**Search by intent**:
```bash
loomgraph search "how to authenticate users"
loomgraph search "database connection logic"
loomgraph search "error handling middleware"
```

---

## üìã Common Workflows

### Workflow 1: Understand a New Module

```bash
# 1. Read the module's documentation
cat src/auth/README_AI.md

# 2. Get structured data
codeindex scan src/auth --output json | jq .

# 3. Find key classes
codeindex scan src/auth --output json | \
  jq '.results[].symbols[] | select(.kind == "class")'

# 4. (Optional) Semantic search
loomgraph search "authentication logic in auth module"
```

### Workflow 2: Find All Usages of a Function

```bash
# If LoomGraph available
loomgraph graph "MyClass.my_method" --direction callers

# Otherwise, use text search
grep -r "my_method" src/
```

### Workflow 3: Update Documentation After Code Changes

```bash
# Regenerate documentation
codeindex scan-all

# Re-index for LoomGraph (if used)
loomgraph index .
```

### Workflow 4: Analyze Code Quality

```bash
# Get statistics
codeindex scan-all --output json | jq '.summary'

# Find large classes (potential refactoring candidates)
codeindex scan-all --output json | \
  jq '.results[].symbols[] | select(.kind == "class" and (.line_end - .line_start) > 100)'
```

---

## üõ†Ô∏è Development Setup

### Initial Setup

```bash
# 1. Install tools
pip install matrix-codeindex

# (Optional) Install LoomGraph
pip install loomgraph

# 2. Generate documentation
codeindex scan-all

# 3. (Optional) Index for semantic search
loomgraph index .
```

### After Code Changes

```bash
# Update documentation
codeindex scan-all

# (Optional) Re-index
loomgraph index .
```

### Git Hooks (Optional)

Automatically update documentation on commit:

Create `.git/hooks/post-commit`:
```bash
#!/bin/bash
# Auto-update codeindex documentation after commit

# Only update if non-documentation files changed
CHANGED_FILES=$(git diff-tree --no-commit-id --name-only -r HEAD)
NON_DOC_FILES=$(echo "$CHANGED_FILES" | grep -v "README_AI.md" || true)

if [ -n "$NON_DOC_FILES" ]; then
    echo "üîÑ Updating code documentation..."
    codeindex scan-all --fallback

    # Auto-commit if documentation changed
    if ! git diff --quiet README_AI.md; then
        git add README_AI.md
        git commit -m "docs: auto-update README_AI.md

Co-Authored-By: Claude Code <noreply@anthropic.com>"
    fi
fi
```

Make it executable:
```bash
chmod +x .git/hooks/post-commit
```

---

## üìä Project Statistics

Run this to get project overview:

```bash
codeindex scan-all --output json | jq '{
  files: .summary.total_files,
  symbols: .summary.total_symbols,
  calls: .summary.total_calls,
  errors: .summary.errors
}'
```

Expected output:
```json
{
  "files": 150,
  "symbols": 1250,
  "calls": 3400,
  "errors": 0
}
```

---

## üîó Resources

- **codeindex Documentation**: https://github.com/dreamlx/codeindex
- **LoomGraph Documentation**: https://github.com/dreamlx/LoomGraph
- **JSON Output Integration Guide**: See codeindex docs

---

## üìù Notes

### When to Regenerate Documentation

- ‚úÖ After adding/removing files
- ‚úÖ After significant refactoring
- ‚úÖ Before code reviews
- ‚úÖ When onboarding new team members
- ‚ùå Not needed for minor edits (docstring updates will be reflected)

### Performance Tips

For large projects (>1000 files):

1. **Use .codeindex.yaml to exclude unnecessary directories**
2. **Scan specific modules** instead of entire project:
   ```bash
   codeindex scan src/core --output json
   ```
3. **Use caching** (LoomGraph feature):
   ```bash
   loomgraph index . --incremental
   ```

---

## üêõ Troubleshooting

**Issue**: `codeindex: command not found`
```bash
# Solution: Install codeindex
pip install matrix-codeindex
```

**Issue**: JSON output shows many errors
```bash
# Check which files failed
codeindex scan-all --output json | jq '.results[] | select(.error != null)'

# Usually due to:
# 1. Syntax errors in Python files
# 2. Unsupported Python syntax (Python 2)
# 3. Binary/non-text files accidentally included
```

**Issue**: LoomGraph can't connect to database
```bash
# Check status
loomgraph status

# Start services (if using Docker)
docker compose up -d postgres embedding
```

---

## üéØ Best Practices

1. **Commit README_AI.md files**: They help team members and AI agents
2. **Update regularly**: Run `codeindex scan-all` after significant changes
3. **Use JSON mode for automation**: Keep Markdown mode for human reading
4. **Configure .codeindex.yaml**: Exclude test files and dependencies
5. **Integrate with CI/CD**: Auto-generate docs on merge to main

---

**Template Version**: v0.7.0
**Last Updated**: 2026-02-04

---

## üí° Customization Guide

To customize this template for your project:

1. Replace `{YOUR_PROJECT_NAME}` with your project name
2. Replace `{DATE}` with current date
3. Update directory structure in examples (src/, lib/, etc.)
4. Add project-specific workflows
5. Update statistics with actual project numbers
6. Add team-specific conventions and guidelines
