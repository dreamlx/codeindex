<!-- Generated by codeindex at 2026-01-23T13:56:09+08:00 -->

# README_AI.md - tests

## Purpose

Test suite for the codeindex module, validating source code parsing capabilities, smart README generation, and directory tree functionality. Tests cover function extraction, class/method parsing, import detection, docstring handling, PHP-specific features (visibility, inheritance, properties), the smart writer's hierarchical indexing system with level-based output and size limits, and the directory tree pre-scan mechanism for accurate level detection.

## Architecture

```
tests/
├── __init__.py              # Package marker
├── test_parser.py           # Parser unit tests using pytest + tempfile fixtures
├── test_smart_writer.py     # Smart writer tests for hierarchical README generation
└── test_directory_tree.py   # Directory tree tests for level detection and traversal
```

The tests use a fixture-based approach where temporary source files/directories are created, processed by the respective modules, and the resulting objects are validated against expected outputs.

## Key Components

### Parser Tests (`test_parser.py`)

| Component | Role |
|-----------|------|
| `test_parse_simple_function()` | Validates extraction of standalone function signatures and docstrings |
| `test_parse_class_with_methods()` | Verifies class and method symbol extraction with hierarchy |
| `test_parse_imports()` | Tests import statement parsing (both `import` and `from...import`) |
| `test_parse_module_docstring()` | Confirms module-level docstring detection |
| `test_parse_nonexistent_file()` | Error handling for missing files |
| `test_parse_php_class_with_inheritance()` | Validates PHP class parsing with `extends` and `implements` |
| `test_parse_php_method_visibility()` | Tests PHP method visibility modifiers (public/private/protected/static) |
| `test_parse_php_properties()` | Verifies PHP class property extraction with types and visibility |
| `test_parse_php_function()` | Validates standalone PHP function parsing with typed signatures |

### Smart Writer Tests (`test_smart_writer.py`)

| Component | Role |
|-----------|------|
| `test_smart_writer_overview_level()` | Tests overview-level README generation with child directory aggregation |
| `test_smart_writer_navigation_level()` | Validates navigation-level output with file/symbol listings |
| `test_smart_writer_detailed_level()` | Verifies detailed-level output with full signatures and dependencies |
| `test_smart_writer_grouping()` | Tests file grouping by suffix patterns (Controller, Service, etc.) |
| `test_smart_writer_symbol_filtering()` | Validates symbol filtering by visibility and name patterns |
| `test_smart_writer_size_limit()` | Tests README size truncation when exceeding configured limits |
| `test_determine_level()` | Validates hierarchical level determination logic (root→overview, module→navigation, leaf→detailed) |
| `_create_mock_parse_result()` | Helper function for creating mock ParseResult objects |

### Directory Tree Tests (`test_directory_tree.py`)

| Component | Role |
|-----------|------|
| `test_directory_tree_build()` | Tests building directory tree and validates statistics (total, with_children, leaf counts) |
| `test_directory_tree_levels()` | Validates level determination: root→overview, dirs with children→navigation, leaves→detailed |
| `test_directory_tree_children()` | Tests `get_children()` method for parent-child relationships |
| `test_directory_tree_processing_order()` | Verifies bottom-up processing order (children before parents) |
| `test_directory_tree_empty()` | Tests graceful handling of empty directories |
| `test_directory_tree_deep_nesting()` | Validates level detection in deeply nested structures (src/a/b/c/d) |
| `_create_test_structure()` | Helper function creating test directory structure with PHP files |

## Consumes

| Module | Import | Purpose |
|--------|--------|---------|
| `codeindex.parser` | `parse_file`, `ParseResult`, `Symbol`, `Import` | Core parsing function and data types |
| `codeindex.config` | `Config`, `IndexingConfig`, `SymbolsConfig`, `GroupingConfig` | Configuration classes for smart writer and directory tree |
| `codeindex.smart_writer` | `SmartWriter`, `determine_level` | Smart README generation under test |
| `codeindex.directory_tree` | `DirectoryTree` | Directory tree pre-scan for level detection |
| `pathlib` | `Path` | File path handling for temp files |
| `pytest` | - | Test framework |
| `tempfile` | - | Temporary file/directory creation for test fixtures |

## Provides

| Export | Consumer | Purpose |
|--------|----------|---------|
| Test functions | pytest runner | Automated validation of parser, smart writer, and directory tree correctness |
