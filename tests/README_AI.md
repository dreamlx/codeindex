<!-- Generated by codeindex at 2026-01-26T15:03:39+08:00 -->

# README_AI.md - tests

## Purpose
Test suite for the codeindex package, providing comprehensive unit tests for core components including directory tree building, code parsing, smart writing functionality, symbol importance scoring with visibility-based, semantic importance, documentation quality, complexity-based, and naming pattern (noise detection) ranking, adaptive symbols configuration, and configuration loading with adaptive symbols support.

## Architecture
The test suite is organized into six main test modules that mirror the core components of the codeindex package:
- `test_directory_tree.py` validates directory structure traversal and tree building
- `test_parser.py` verifies code parsing capabilities for Python and PHP
- `test_smart_writer.py` tests intelligent README generation with different detail levels
- `test_symbol_scorer.py` validates symbol importance scoring with contextual awareness, visibility scoring, semantic importance scoring, documentation quality scoring, complexity scoring, and naming pattern scoring across languages
- `test_adaptive_config.py` validates adaptive symbols configuration data structures, default values, validation rules, and configuration overrides
- `test_config_adaptive.py` validates Config class integration with adaptive symbols configuration, YAML loading, backward compatibility, and configuration merging

## Key Components
- `_create_test_structure()`: Creates temporary directory structures for testing
- `test_directory_tree_*`: Validates DirectoryTree class functionality including level determination, children management, and processing order
- `test_parse_*()`: Tests parsing of functions, classes, PHP syntax features, and error handling
- `test_smart_writer_*()`: Verifies README generation at different detail levels, file grouping, and size limits
- `TestSymbolScorerBase`: Tests symbol scorer initialization, scoring consistency, and score differentiation
- `TestVisibilityScoring`: Validates visibility-based scoring for PHP (public/protected/private) and Python (public/private/magic methods)
- `TestSemanticScoring`: Validates semantic importance scoring based on method name keywords (critical: 25.0, secondary: 15.0, generic: 5.0)
- `TestDocumentationScoring`: Validates documentation quality scoring based on docstring length (long >200 chars: 15.0, medium >50 chars: 10.0, short: 5.0, none: 0.0)
- `TestComplexityScoring`: Validates complexity scoring based on method line count (>100 lines: 20.0, 50-100 lines: 15.0, 20-50 lines: 10.0, <20 lines: 5.0)
- `TestNamingPatternScoring`: Validates naming pattern scoring (noise detection) with penalties for getter/setter methods (-10.0), is/has methods (-10.0), private methods (-15.0), and magic methods (-20.0)
- `TestAdaptiveSymbolsConfig`: Validates AdaptiveSymbolsConfig data class, default configuration, custom initialization, and partial overrides
- `TestConfigurationValidation`: Validates configuration constraints (positive values, reasonable ranges, min/max bounds)
- `TestExpectedDefaults`: Validates default values match planning specifications
- `TestSymbolsConfigAdaptive`: Validates SymbolsConfig integration with adaptive_symbols field and default behavior
- `TestConfigLoadingAdaptive`: Validates Config.load() with adaptive symbols configuration from YAML files
- `TestConfigurationMerging`: Validates user configuration merging with default values for thresholds and limits
- `TestBackwardCompatibility`: Validates backward compatibility with existing configurations without adaptive symbols
- `_create_mock_parse_result()`: Helper for creating mock parsing results

## Consumes
| Module | Purpose |
|--------|---------|
| codeindex.adaptive_config | AdaptiveSymbolsConfig, DEFAULT_ADAPTIVE_CONFIG for adaptive behavior configuration |
| codeindex.config | Config, GroupingConfig, IndexingConfig, SymbolsConfig for configuration management |
| codeindex.directory_tree | DirectoryTree class for structure validation |
| codeindex.parser | ParseResult, Symbol, Import classes and parse_file function |
| codeindex.smart_writer | SmartWriter class and determine_level function |
| codeindex.symbol_scorer | SymbolImportanceScorer, ScoringContext for importance ranking |
| pytest | Test fixtures and utilities |
| tempfile | Temporary file and directory creation for testing |
| pathlib | Path handling for configuration files |
| yaml | YAML file serialization for configuration testing |

## Provides
| Export | Purpose |
|--------|---------|
| Test cases | Validates core package functionality |
| Test utilities | Helper functions for creating test data and structures |
| Visibility scoring tests | Validates language-specific visibility scoring rules |
| Semantic scoring tests | Validates keyword-based semantic importance scoring with case-insensitive matching |
| Documentation scoring tests | Validates docstring-based quality scoring (long/medium/short/none) |
| Complexity scoring tests | Validates line-count-based complexity scoring (very large/large/medium/small methods) |
| Naming pattern scoring tests | Validates noise detection penalties for getter/setter methods, boolean check methods, private methods, and magic methods |
| Adaptive config tests | Validates adaptive symbols configuration data structure, defaults, thresholds, limits, and validation rules |
| Config loading tests | Validates YAML configuration loading with adaptive symbols support |
| Backward compatibility tests | Validates existing configurations continue to work without adaptive symbols |
| Configuration merging tests | Validates user overrides merge correctly with defaults |

## Test Coverage
- Directory tree building and traversal logic
- Code parsing for Python and PHP languages
- Multi-level README generation
- File grouping and symbol filtering
- Symbol importance scoring with context awareness
- Visibility-based scoring (PHP: public=20, protected=10, private=0; Python: public=15, private/magic=5)
- Semantic importance scoring (critical keywords=25.0, secondary keywords=15.0, generic=5.0)
- Documentation quality scoring (long docstrings=15.0, medium=10.0, short=5.0, none/null=0.0)
- Complexity scoring (>100 lines=20.0, 50-100 lines=15.0, 20-50 lines=10.0, <20 lines=5.0)
- Naming pattern scoring (getter/setter=-10.0, is/has methods=-10.0, private methods=-15.0, magic methods=-20.0, normal methods=0.0)
- Adaptive configuration data class instantiation and defaults
- Configuration thresholds (tiny=100, small=200, medium=500, large=1000, xlarge=2000, huge=5000)
- Configuration limits (tiny=10, small=15, medium=30, large=50, xlarge=80, huge=120, mega=150)
- Configuration validation (positive values, increasing thresholds/limits, min=5/max=200 symbols)
- Configuration overrides and partial customization
- SymbolsConfig integration with adaptive_symbols field
- Config.load() with adaptive symbols from YAML files
- YAML loading without adaptive symbols (backward compatibility)
- YAML loading with enabled adaptive symbols
- YAML loading with custom thresholds and limits
- YAML loading with partial threshold/limit overrides
- YAML loading with min_symbols and max_symbols
- Configuration merging preserves user-specified values
- Empty adaptive_symbols configuration uses defaults
- Old configuration files without adaptive symbols continue working
- Backward compatibility (disabled by default)
- Case-insensitive keyword matching for semantic scoring
- Scorer initialization and consistency
- Score range validation (0-100)
- Error handling and edge cases
- Size limit enforcement
