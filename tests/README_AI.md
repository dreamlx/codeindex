<!-- Generated by codeindex at 2026-02-12T23:01:22+08:00 -->

# README_AI.md - tests

## Overview

- **Files**: 76
- **Symbols**: 1340+
- **Subdirectories**: 1

## Subdirectories

- **extractors/** - _Tests for route extractors._

## Files

- __init__.py
- **conftest.py** - create_mock_symbol, create_mock_parse_result, mock_config
- __init__.py
- **test_spring.py** - TestBasicRouteExtraction, TestMultipleRoutes, TestControllerAnnotation
- **test_thinkphp.py** - TestThinkPHPRouteExtractor, test_extract_routes_only_public_methods
- **test_thinkphp_description.py** - TestThinkPHPDescriptionExtraction
- **test_adaptive_config.py** - TestAdaptiveSymbolsConfig, TestConfigurationValidation, TestExpectedDefaults
- **test_adaptive_selector.py** - TestAdaptiveSymbolSelectorBase, TestSizeCategoryDetermination, TestConstraintApplication
- **test_ai_helper.py** - test_aggregate_multiple_parse_results, test_aggregate_single_parse_result, test_aggregate_empty_parse_results
- **test_backward_compatibility.py** - TestBackwardCompatibility
- **test_claude_md_injection.py** - TestInjectClaudeMd, TestHasClaudeMdInjection. Unit tests for CLAUDE.md injection functions (inject_claude_md / has_claude_md_injection) from codeindex.init_wizard. TestInjectClaudeMd validates: file creation when missing, section content (markers, instructions, CODEINDEX.md reference), prepending to existing files with content preservation, idempotent replacement between markers, empty/whitespace-only file handling, return path. TestHasClaudeMdInjection validates: False when no file exists, False when no marker present, True after injection, True when marker exists in manually written content.
- **test_cli_docstring_options.py** - TestDocstringCLIOptions, TestDocstringHelp
- **test_cli_hooks.py** - TestHookManager, TestHookGeneration, TestBackupAndRestore
- **test_cli_json.py** - TestScanJSONOutput, TestScanAllJSONOutput, TestJSONErrorHandling
- **test_cli_parse.py** - TestCliParse. Tests `parse` command: basic functionality (Python/PHP/Java JSON output, help text, version compatibility), JSON format validation (required fields, symbols structure, optional fields, round-trip, consistency with scan), error handling (file not found, unsupported language, syntax errors, empty files, permission denied), framework features (ThinkPHP routes, Spring annotations, inheritance), and performance benchmarks (<0.5s for small files, <3s for large files).
- **test_cli_scan_defaults_bdd.py** - BDD tests for CLI scan default behavior (Epic 19 Story 19.1). Tests that scan/scan-all defaults to structural mode (no AI required) and AI is opt-in via --ai flag. Validates scan command behavior: without --ai (SmartWriter structural output, no AI CLI invocation), with --ai (AI CLI invocation when ai_command configured, error when not configured), --fallback deprecation warning, --dry-run requiring --ai flag. Also validates scan-all command: without --ai (all directories processed with SmartWriter), with --ai (AI CLI invoked for directories), --fallback deprecation. Uses Click CliRunner with InProjectDir context manager for temporary project directory isolation.
- **test_cli_tech_debt.py** - TestTechDebtCommand, TestTechDebtIntegration, sample_files
- **test_config_adaptive.py** - TestSymbolsConfigAdaptive, TestConfigLoadingAdaptive, TestConfigurationMerging
- **test_dataclass_structure.py** - TestInheritanceDataclass, TestImportWithAlias, TestParseResultWithInheritances
- **test_directory_tree.py** - _create_test_structure, test_directory_tree_build, test_directory_tree_levels
- **test_docstring_config.py** - TestDocstringConfig, TestBackwardCompatibility
- **test_docstring_processor.py** - TestDocstringProcessor
- **test_error_handling.py** - TestCommandLevelErrors, TestErrorObjectStructure, TestFileLevelErrors
- **test_file_classifier.py** - test_classify_tiny_file, test_classify_small_file, test_classify_medium_file
- **test_help_system_bdd.py** - BDD tests for Enhanced Help System (Epic 15 Story 15.3). Tests help command execution and output validation: parameter descriptions, range information, structured formatting (tables/headers), terminal readability, configuration examples, YAML syntax examples, current value display from .codeindex.yaml, and warning messages. Fixtures: help_context (command execution state), cli_available (CLI availability check). Step functions handle config creation with specific parameter values, CPU core mocking, command execution with output capture, and comprehensive output assertions (text matching, formatting validation, example presence, exit code verification).
- **test_hooks_config.py** - TestHooksConfig, TestPostCommitConfig
- **test_init_wizard_bdd.py** - BDD tests for Interactive Setup Wizard (Epic 15 Story 15.1). Tests wizard execution flow with full implementation integration: language detection (detect_languages), framework detection (detect_frameworks), pattern inference (infer_include_patterns, infer_exclude_patterns), performance optimization (calculate_parallel_workers, calculate_batch_size), configuration generation (generate_config_yaml), CODEINDEX.md creation (create_codeindex_md), and CLAUDE.md injection (inject_claude_md, has_claude_md_injection). Validates end-to-end wizard workflow from project scanning to config file creation with accurate values and zero-input automation support. Includes CLAUDE.md injection BDD steps: existing file handling, injection request/skip, marker validation, content preservation, idempotent updates. Mocks os.cpu_count() for large projects (>=1000 files) to ensure consistent parallel_workers calculation across environments.
- **test_java_annotations.py** - TestClassAnnotations, TestMethodAnnotations, TestFieldAnnotations
- **test_java_calls.py** - TestBasicMethodCalls, TestConstructorCalls, TestStaticImportResolution, TestFullQualifiedNameCalls, TestMethodReferences, TestProjectInternalFiltering, TestEdgeCases, TestAnnotationBasedCalls. Validates fully-qualified caller names (e.g., com.example.UserService.createUser) for accurate call graph analysis, ensuring package.Class.method format in all assertions.
- **test_java_edge_cases.py** - TestNestedClasses, TestComplexGenerics, TestLongSignatures
- **test_java_error_recovery.py** - TestSyntaxErrors, TestIncompleteDeclarations, TestMalformedGenerics
- **test_java_generic_bounds.py** - TestSingleExtendsBound, TestMultipleBounds, TestWildcardBounds
- **test_java_inheritance.py** - TestBasicInheritance, TestGenericTypes, TestImportResolution, TestNestedClasses, TestRealWorldFrameworks, TestEdgeCases, TestAdvancedJavaInheritance. Auto-generated from test_generator/specs/java.yaml. Tests Java inheritance extraction: basic extends/implements, generic type parameters, import resolution (explicit, java.lang implicit, same-package, FQN), nested/static nested classes, real-world framework patterns (Spring Boot, JPA, Lombok), edge cases (enum, record, annotation), and advanced patterns (diamond inheritance, sealed classes, wildcard extends, multiple interface extends).
- **test_java_lambda.py** - TestSimpleLambda, TestLambdaWithParameters, TestBlockLambda
- **test_java_lombok.py** - TestBasicLombokAnnotations, TestConstructorAnnotations, TestBuilderAnnotation
- **test_java_module.py** - TestBasicModuleDeclaration, TestRequiresDirective, TestExportsDirective
- **test_java_parser.py** - TestJavaParserBasics, TestJavaSymbolExtraction, TestJavaImports
- **test_java_spring.py** - TestSpringControllerLayer, TestSpringServiceLayer, TestSpringRepositoryLayer
- **test_java_throws.py** - TestSingleThrows, TestMultipleThrows, TestGenericThrows
- **test_json_output.py** - TestSymbolSerialization, TestImportSerialization, TestParseResultSerialization
- **test_loomgraph_integration.py** - TestLoomGraphJSONFormat, TestLoomGraphDataMapping, TestLoomGraphRealWorldExample
- **test_parallel_scan.py** - TestParallelScanning, TestParallelPerformance, TestParallelCorrectness
- **test_parser.py** - test_parse_simple_function, test_parse_class_with_methods, test_parse_imports
- **test_parser_detection.py** - TestCheckParserInstalled, TestParserInstallGuidance, TestInitWizardPostMessage. Tests for parser installation detection (Epic 19 Story 19.4). TestCheckParserInstalled validates check_parser_installed function: Python/Java/PHP parsers detected as installed, unknown languages (cobol) and unsupported languages (rust) report not installed. TestParserInstallGuidance validates get_parser_install_guidance: all installed parsers return empty missing list, mixed installed/missing languages separate correctly, empty language list returns empty guidance. TestInitWizardPostMessage validates updated post-init messages (Story 19.2): post-init suggests scan-all command, mentions --ai as optional, generated config has no active ai_command (AI is opt-in). Uses Click CliRunner with tmp_path for CLI integration tests.
- **test_php_comment_extraction.py** - TestPHPCommentExtraction
- **test_php_docstring_extraction.py** - TestPHPDocstringExtraction, TestSmartWriterIntegration, TestPHPParserEdgeCases
- **test_php_import_alias.py** - TestPHPImportAliasBasic, TestPHPImportAliasGroupImports, TestPHPImportAliasNamespace
- **test_php_inheritance.py** - TestPHPInheritanceBasic, TestPHPInheritanceNamespace, TestPHPInheritanceModifiers, TestPHPInheritanceEdgeCases, TestPHPInheritanceGroupImports, TestPHPInheritanceRealWorld, TestPHPInheritanceAdvanced. Auto-generated from test_generator/specs/php.yaml. Tests PHP inheritance extraction: basic extends/implements, namespace resolution (use statements, aliases, group imports), class modifiers (abstract, final), edge cases (no inheritance, empty file, multiple classes, inheritance chains), real-world patterns (Laravel Model, Symfony Controller), and advanced patterns (interface extends, traits, constructor inheritance, readonly classes, PHP 8.1 enums).
- **test_php_loomgraph_integration.py** - TestPHPLoomGraphJSONFormat, TestPHPLoomGraphRealWorld, TestPHPLoomGraphEdgeCases
- **test_project_index_semantic.py** - TestExtractModulePurpose, TestProjectIndexGeneration, TestBDDProjectIndex
- **test_python_calls.py** - TestBasicFunctionCalls, TestMethodCalls, TestConstructorCalls, TestAliasResolution, TestDecoratorCalls, TestProjectInternalFiltering, TestEdgeCases. Tests document AST-level classification decisions: module.function() classified as METHOD (requires semantic analysis for FUNCTION), local variable methods preserved as-is (type inference out of scope), constructors formatted with .__init__ suffix for semantic clarity.
- **test_python_docstring_description.py** - TestPythonDocstringDescription
- **test_python_import_alias.py** - TestImportAsBasic, TestFromImportAs, TestComplexScenarios
- **test_python_inheritance.py** - TestSingleInheritance, TestMultipleInheritance, TestNoInheritance, TestNestedClassInheritance, TestGenericInheritance, TestComplexScenarios, TestEdgeCases, TestAdvancedInheritance. Auto-generated from test_generator/specs/python.yaml. Tests Python inheritance extraction: single/multiple inheritance, qualified names, no inheritance, nested classes (external parent, deeply nested), generic types (Generic[T], List[str], multiple type params), complex scenarios (mixed inheritance, chains, methods), edge cases (empty file, no classes, comments, object parent), and advanced patterns (ABC, dataclass, enum, exception hierarchy, mixins, diamond inheritance, Protocol, metaclass, decorators).
- **test_route_extractor.py** - TestExtractionContext, TestRouteExtractor
- **test_route_info.py** - TestRouteInfoLineNumber
- **test_route_registry.py** - TestFrameworkExtractor, AnotherFrameworkExtractor, TestRouteExtractorRegistry
- **test_route_table_description.py** - TestRouteTableDescription
- **test_route_table_display.py** - TestRouteTableDisplay
- **test_scanner_passthrough.py** - TestIsPassThrough, TestDirectoryTreePassthrough. Tests for pass-through directory skipping (Epic 19 Story 19.5). TestIsPassThrough validates the is_pass_through function: single subdir with no code files detected as pass-through, directories with code files not skipped, multiple subdirs not pass-through (navigation value), empty dirs not pass-through, excluded subdirs not counted, non-code files ignored, Java extension checking. TestDirectoryTreePassthrough validates DirectoryTree integration: Java Maven structure skips intermediate directories (src/main/java/com/zcyl/gateway/ reduces to leaf only), Python flat structures with code files never skipped, directories with multiple subdirs kept for navigation value, deep pass-through chains all skipped (com/zcyl/service/impl/).
- **test_semantic_extractor.py** - TestDirectoryContext, TestBusinessSemantic, TestSemanticExtractor
- **test_smart_writer.py** - _create_mock_parse_result, test_smart_writer_overview_level, test_smart_writer_navigation_level
- **test_smart_writer_adaptive.py** - TestSmartWriterAdaptiveDisabled, TestSmartWriterAdaptiveEnabled, TestRealWorldScenarios
- **test_smart_writer_docstring.py** - TestSmartWriterDocstringIntegration, TestSmartWriterProcessorFactory
- **test_smart_writer_integration.py** - TestSmartWriterRouteIntegration
- **test_smart_writer_semantic.py** - TestSemanticConfig, TestSmartWriterSemanticIntegration, TestBDDSemanticIntegration
- **test_story_4_4_integration.py** - TestStory44EndToEnd, TestStory44PerformanceValidation
- **test_symbol_overload.py** - TestSymbolOverloadAnalysis, TestSymbolCountDetection, TestNoiseRatioDetection
- **test_symbol_scorer.py** - TestSymbolScorerBase, TestVisibilityScoring, TestSemanticScoring
- **test_tech_debt_bdd.py** - tech_debt_detector_fixture, symbol_scorer_fixture, file_with_lines
- **test_tech_debt_detector.py** - TestDebtSeverity, TestDebtIssue, TestDebtAnalysisResult
- **test_tech_debt_formatters.py** - TestConsoleFormatter, TestMarkdownFormatter, TestJSONFormatter
- **test_tech_debt_java.py** - TestJavaAutoRecursive, TestJavaNoiseAnalysis, TestJavaScorerBoost. Tests for Java-specific tech-debt improvements (Epic 19 Story 19.6). TestJavaAutoRecursive validates auto-enabling recursive scanning for Java projects: Java config auto-enables recursive for nested files, explicit --recursive still works, non-Java projects do not auto-recurse, Java hint message removed. TestJavaNoiseAnalysis validates language-aware noise analysis: Java getters/setters not counted as noise, _analyze_noise_breakdown skips Java getters, Python noise analysis unchanged (get_xxx/set_xxx still noise), PHP noise analysis unchanged. TestJavaScorerBoost validates Java getter/setter scoring: Java getter scores >= 30.0 threshold, Java setter scores >= 30.0 threshold, Python getter scoring unchanged.
- **test_tech_debt_reporter.py** - TestFileReport, TestTechDebtReport, TestTechDebtReporter
- **test_thinkphp_route_extractor.py** - TestThinkPHPRouteLineNumbers, test_extract_routes_only_public_methods
- **test_windows_path_optimization.py** - TestRelativePathOptimization, TestAbsolutePathBackwardCompatibility, TestPathLengthReduction, TestWindowsCrossDrive, TestSymlinkHandling, TestPathSeparatorNormalization, TestExistingScannerBehavior. Tests Windows path length optimization (Issue #8): verifies relative path usage reduces path lengths, maintains backward compatibility with absolute paths, handles cross-drive scenarios, symlink resolution, and cross-platform path separator normalization.

---

## Recent Changes

**test_claude_md_injection.py**: New test suite for CLAUDE.md injection functions (inject_claude_md / has_claude_md_injection) from codeindex.init_wizard. TestInjectClaudeMd (8 tests) validates: file creation when CLAUDE.md is missing, created file contains codeindex section with markers and instructions (README_AI.md reference, codeindex status, CODEINDEX.md), prepending section to existing CLAUDE.md with original content preserved, idempotent replacement between markers (no duplication on re-run), idempotent update preserves surrounding content, return path correctness, empty file handling, whitespace-only file handling. TestHasClaudeMdInjection (4 tests) validates: returns False when no CLAUDE.md exists, returns False when file exists without marker, returns True after inject_claude_md runs, returns True when marker manually present. Imports CLAUDE_MD_MARKER_END, CLAUDE_MD_MARKER_START, CLAUDE_MD_SECTION, has_claude_md_injection, inject_claude_md from codeindex.init_wizard.

**test_init_wizard_bdd.py**: Added CLAUDE.md injection BDD step definitions. New imports: CLAUDE_MD_MARKER_END, CLAUDE_MD_MARKER_START, has_claude_md_injection, inject_claude_md from codeindex.init_wizard. New step functions: existing_claude_md (given existing CLAUDE.md), claude_md_with_injection (given pre-injected CLAUDE.md), request_claude_md_injection (when injection requested), skip_claude_md_injection (when injection skipped), claude_md_created_with_section (then file created), has_codeindex_marker (then markers present), has_readme_instruction (then README_AI.md instruction present), claude_md_has_section (then section present), original_content_preserved (then existing content kept), exactly_one_section (then single section count), markers_content_updated (then content between markers valid), no_claude_md (then file does not exist).

**test_parser_detection.py**: New test suite for parser installation detection (Epic 19 Story 19.4). TestCheckParserInstalled validates check_parser_installed function from codeindex.init_wizard: Python/Java/PHP parsers detected as installed, unknown languages (cobol) report not installed, unsupported languages without parser mapping (rust) report not installed. TestParserInstallGuidance validates get_parser_install_guidance: all installed parsers (python, java, php) return empty missing list, mixed installed/missing languages correctly separate into installed and missing lists, empty language list returns empty guidance. TestInitWizardPostMessage validates updated post-init messages (Story 19.2): post-init output suggests scan-all command, mentions AI as optional (--ai flag), generated config has empty ai_command (AI is opt-in). Uses Click CliRunner with tmp_path for CLI integration tests, imports from codeindex.init_wizard and codeindex.cli.

**test_tech_debt_java.py**: New test suite for Java-specific tech-debt improvements (Epic 19 Story 19.6). TestJavaAutoRecursive validates auto-enabling recursive scanning for Java projects via CLI: Java config auto-enables recursive for deeply nested files, explicit --recursive still works for non-Java, non-Java projects do not auto-recurse, old "Try adding --recursive" hint message removed. TestJavaNoiseAnalysis validates language-aware noise analysis in TechDebtDetector: Java getters/setters not counted as noise (no high severity low_quality_symbols issue), _analyze_noise_breakdown skips Java getters/setters, Python and PHP noise analysis unchanged. TestJavaScorerBoost validates SymbolImportanceScorer Java getter/setter scoring above 30.0 threshold. Imports from codeindex.config.Config, codeindex.parser.ParseResult/Symbol, codeindex.symbol_scorer.ScoringContext/SymbolImportanceScorer, codeindex.tech_debt.TechDebtDetector.

**test_scanner_passthrough.py**: New test suite for pass-through directory skipping (Epic 19 Story 19.5). Tests the is_pass_through function and DirectoryTree integration for skipping directories that have no code files and exactly one subdirectory. Validates behavior for Java Maven deep directory structures (src/main/java/com/zcyl/), Python flat structures, navigation-value directories with multiple subdirs, excluded subdirectory handling, non-code file ignoring, and deep pass-through chain skipping. Imports from codeindex.config.Config, codeindex.scanner.is_pass_through, and codeindex.directory_tree.DirectoryTree.

**test_cli_scan_defaults_bdd.py**: New BDD test suite for CLI scan default behavior (Epic 19 Story 19.1). Tests the reversed scan defaults where structural mode (SmartWriter) is the default and AI is opt-in via --ai flag. Covers scan command scenarios: default structural output without AI, AI invocation with --ai flag, error handling when ai_command is missing, --fallback deprecation warning, --dry-run requiring --ai. Also covers scan-all command scenarios: default SmartWriter processing, AI opt-in for all directories, --fallback deprecation. Uses Click CliRunner, pytest_bdd scenarios from features/cli_scan_defaults.feature, and InProjectDir context manager for project directory isolation.
