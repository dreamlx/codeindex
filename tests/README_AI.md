<!-- Generated by codeindex at 2026-02-12T15:11:36+08:00 -->

# README_AI.md - tests

## Overview

- **Files**: 72
- **Symbols**: 1280+
- **Subdirectories**: 1

## Subdirectories

- **extractors/** - _Tests for route extractors._

## Files

- __init__.py
- **conftest.py** - create_mock_symbol, create_mock_parse_result, mock_config
- __init__.py
- **test_spring.py** - TestBasicRouteExtraction, TestMultipleRoutes, TestControllerAnnotation
- **test_thinkphp.py** - TestThinkPHPRouteExtractor, test_extract_routes_only_public_methods
- **test_thinkphp_description.py** - TestThinkPHPDescriptionExtraction
- **test_adaptive_config.py** - TestAdaptiveSymbolsConfig, TestConfigurationValidation, TestExpectedDefaults
- **test_adaptive_selector.py** - TestAdaptiveSymbolSelectorBase, TestSizeCategoryDetermination, TestConstraintApplication
- **test_ai_helper.py** - test_aggregate_multiple_parse_results, test_aggregate_single_parse_result, test_aggregate_empty_parse_results
- **test_backward_compatibility.py** - TestBackwardCompatibility
- **test_cli_docstring_options.py** - TestDocstringCLIOptions, TestDocstringHelp
- **test_cli_hooks.py** - TestHookManager, TestHookGeneration, TestBackupAndRestore
- **test_cli_json.py** - TestScanJSONOutput, TestScanAllJSONOutput, TestJSONErrorHandling
- **test_cli_parse.py** - TestCliParse. Tests `parse` command: basic functionality (Python/PHP/Java JSON output, help text, version compatibility), JSON format validation (required fields, symbols structure, optional fields, round-trip, consistency with scan), error handling (file not found, unsupported language, syntax errors, empty files, permission denied), framework features (ThinkPHP routes, Spring annotations, inheritance), and performance benchmarks (<0.5s for small files, <3s for large files).
- **test_cli_scan_defaults_bdd.py** - BDD tests for CLI scan default behavior (Epic 19 Story 19.1). Tests that scan/scan-all defaults to structural mode (no AI required) and AI is opt-in via --ai flag. Validates scan command behavior: without --ai (SmartWriter structural output, no AI CLI invocation), with --ai (AI CLI invocation when ai_command configured, error when not configured), --fallback deprecation warning, --dry-run requiring --ai flag. Also validates scan-all command: without --ai (all directories processed with SmartWriter), with --ai (AI CLI invoked for directories), --fallback deprecation. Uses Click CliRunner with InProjectDir context manager for temporary project directory isolation.
- **test_cli_tech_debt.py** - TestTechDebtCommand, TestTechDebtIntegration, sample_files
- **test_config_adaptive.py** - TestSymbolsConfigAdaptive, TestConfigLoadingAdaptive, TestConfigurationMerging
- **test_dataclass_structure.py** - TestInheritanceDataclass, TestImportWithAlias, TestParseResultWithInheritances
- **test_directory_tree.py** - _create_test_structure, test_directory_tree_build, test_directory_tree_levels
- **test_docstring_config.py** - TestDocstringConfig, TestBackwardCompatibility
- **test_docstring_processor.py** - TestDocstringProcessor
- **test_error_handling.py** - TestCommandLevelErrors, TestErrorObjectStructure, TestFileLevelErrors
- **test_file_classifier.py** - test_classify_tiny_file, test_classify_small_file, test_classify_medium_file
- **test_help_system_bdd.py** - BDD tests for Enhanced Help System (Epic 15 Story 15.3). Tests help command execution and output validation: parameter descriptions, range information, structured formatting (tables/headers), terminal readability, configuration examples, YAML syntax examples, current value display from .codeindex.yaml, and warning messages. Fixtures: help_context (command execution state), cli_available (CLI availability check). Step functions handle config creation with specific parameter values, CPU core mocking, command execution with output capture, and comprehensive output assertions (text matching, formatting validation, example presence, exit code verification).
- **test_hooks_config.py** - TestHooksConfig, TestPostCommitConfig
- **test_init_wizard_bdd.py** - BDD tests for Interactive Setup Wizard (Epic 15 Story 15.1). Tests wizard execution flow with full implementation integration: language detection (detect_languages), framework detection (detect_frameworks), pattern inference (infer_include_patterns, infer_exclude_patterns), performance optimization (calculate_parallel_workers, calculate_batch_size), configuration generation (generate_config_yaml), and CODEINDEX.md creation (create_codeindex_md). Validates end-to-end wizard workflow from project scanning to config file creation with accurate values and zero-input automation support. Mocks os.cpu_count() for large projects (>=1000 files) to ensure consistent parallel_workers calculation across environments.
- **test_java_annotations.py** - TestClassAnnotations, TestMethodAnnotations, TestFieldAnnotations
- **test_java_calls.py** - TestBasicMethodCalls, TestConstructorCalls, TestStaticImportResolution, TestFullQualifiedNameCalls, TestMethodReferences, TestProjectInternalFiltering, TestEdgeCases, TestAnnotationBasedCalls. Validates fully-qualified caller names (e.g., com.example.UserService.createUser) for accurate call graph analysis, ensuring package.Class.method format in all assertions.
- **test_java_edge_cases.py** - TestNestedClasses, TestComplexGenerics, TestLongSignatures
- **test_java_error_recovery.py** - TestSyntaxErrors, TestIncompleteDeclarations, TestMalformedGenerics
- **test_java_generic_bounds.py** - TestSingleExtendsBound, TestMultipleBounds, TestWildcardBounds
- **test_java_inheritance.py** - TestBasicInheritance, TestGenericTypes, TestImportResolution, TestNestedClasses, TestRealWorldFrameworks, TestEdgeCases, TestAdvancedJavaInheritance. Auto-generated from test_generator/specs/java.yaml. Tests Java inheritance extraction: basic extends/implements, generic type parameters, import resolution (explicit, java.lang implicit, same-package, FQN), nested/static nested classes, real-world framework patterns (Spring Boot, JPA, Lombok), edge cases (enum, record, annotation), and advanced patterns (diamond inheritance, sealed classes, wildcard extends, multiple interface extends).
- **test_java_lambda.py** - TestSimpleLambda, TestLambdaWithParameters, TestBlockLambda
- **test_java_lombok.py** - TestBasicLombokAnnotations, TestConstructorAnnotations, TestBuilderAnnotation
- **test_java_module.py** - TestBasicModuleDeclaration, TestRequiresDirective, TestExportsDirective
- **test_java_parser.py** - TestJavaParserBasics, TestJavaSymbolExtraction, TestJavaImports
- **test_java_spring.py** - TestSpringControllerLayer, TestSpringServiceLayer, TestSpringRepositoryLayer
- **test_java_throws.py** - TestSingleThrows, TestMultipleThrows, TestGenericThrows
- **test_json_output.py** - TestSymbolSerialization, TestImportSerialization, TestParseResultSerialization
- **test_loomgraph_integration.py** - TestLoomGraphJSONFormat, TestLoomGraphDataMapping, TestLoomGraphRealWorldExample
- **test_parallel_scan.py** - TestParallelScanning, TestParallelPerformance, TestParallelCorrectness
- **test_parser.py** - test_parse_simple_function, test_parse_class_with_methods, test_parse_imports
- **test_php_comment_extraction.py** - TestPHPCommentExtraction
- **test_php_docstring_extraction.py** - TestPHPDocstringExtraction, TestSmartWriterIntegration, TestPHPParserEdgeCases
- **test_php_import_alias.py** - TestPHPImportAliasBasic, TestPHPImportAliasGroupImports, TestPHPImportAliasNamespace
- **test_php_inheritance.py** - TestPHPInheritanceBasic, TestPHPInheritanceNamespace, TestPHPInheritanceModifiers, TestPHPInheritanceEdgeCases, TestPHPInheritanceGroupImports, TestPHPInheritanceRealWorld, TestPHPInheritanceAdvanced. Auto-generated from test_generator/specs/php.yaml. Tests PHP inheritance extraction: basic extends/implements, namespace resolution (use statements, aliases, group imports), class modifiers (abstract, final), edge cases (no inheritance, empty file, multiple classes, inheritance chains), real-world patterns (Laravel Model, Symfony Controller), and advanced patterns (interface extends, traits, constructor inheritance, readonly classes, PHP 8.1 enums).
- **test_php_loomgraph_integration.py** - TestPHPLoomGraphJSONFormat, TestPHPLoomGraphRealWorld, TestPHPLoomGraphEdgeCases
- **test_project_index_semantic.py** - TestExtractModulePurpose, TestProjectIndexGeneration, TestBDDProjectIndex
- **test_python_calls.py** - TestBasicFunctionCalls, TestMethodCalls, TestConstructorCalls, TestAliasResolution, TestDecoratorCalls, TestProjectInternalFiltering, TestEdgeCases. Tests document AST-level classification decisions: module.function() classified as METHOD (requires semantic analysis for FUNCTION), local variable methods preserved as-is (type inference out of scope), constructors formatted with .__init__ suffix for semantic clarity.
- **test_python_docstring_description.py** - TestPythonDocstringDescription
- **test_python_import_alias.py** - TestImportAsBasic, TestFromImportAs, TestComplexScenarios
- **test_python_inheritance.py** - TestSingleInheritance, TestMultipleInheritance, TestNoInheritance, TestNestedClassInheritance, TestGenericInheritance, TestComplexScenarios, TestEdgeCases, TestAdvancedInheritance. Auto-generated from test_generator/specs/python.yaml. Tests Python inheritance extraction: single/multiple inheritance, qualified names, no inheritance, nested classes (external parent, deeply nested), generic types (Generic[T], List[str], multiple type params), complex scenarios (mixed inheritance, chains, methods), edge cases (empty file, no classes, comments, object parent), and advanced patterns (ABC, dataclass, enum, exception hierarchy, mixins, diamond inheritance, Protocol, metaclass, decorators).
- **test_route_extractor.py** - TestExtractionContext, TestRouteExtractor
- **test_route_info.py** - TestRouteInfoLineNumber
- **test_route_registry.py** - TestFrameworkExtractor, AnotherFrameworkExtractor, TestRouteExtractorRegistry
- **test_route_table_description.py** - TestRouteTableDescription
- **test_route_table_display.py** - TestRouteTableDisplay
- **test_semantic_extractor.py** - TestDirectoryContext, TestBusinessSemantic, TestSemanticExtractor
- **test_smart_writer.py** - _create_mock_parse_result, test_smart_writer_overview_level, test_smart_writer_navigation_level
- **test_smart_writer_adaptive.py** - TestSmartWriterAdaptiveDisabled, TestSmartWriterAdaptiveEnabled, TestRealWorldScenarios
- **test_smart_writer_docstring.py** - TestSmartWriterDocstringIntegration, TestSmartWriterProcessorFactory
- **test_smart_writer_integration.py** - TestSmartWriterRouteIntegration
- **test_smart_writer_semantic.py** - TestSemanticConfig, TestSmartWriterSemanticIntegration, TestBDDSemanticIntegration
- **test_story_4_4_integration.py** - TestStory44EndToEnd, TestStory44PerformanceValidation
- **test_symbol_overload.py** - TestSymbolOverloadAnalysis, TestSymbolCountDetection, TestNoiseRatioDetection
- **test_symbol_scorer.py** - TestSymbolScorerBase, TestVisibilityScoring, TestSemanticScoring
- **test_tech_debt_bdd.py** - tech_debt_detector_fixture, symbol_scorer_fixture, file_with_lines
- **test_tech_debt_detector.py** - TestDebtSeverity, TestDebtIssue, TestDebtAnalysisResult
- **test_tech_debt_formatters.py** - TestConsoleFormatter, TestMarkdownFormatter, TestJSONFormatter
- **test_tech_debt_reporter.py** - TestFileReport, TestTechDebtReport, TestTechDebtReporter
- **test_thinkphp_route_extractor.py** - TestThinkPHPRouteLineNumbers, test_extract_routes_only_public_methods
- **test_windows_path_optimization.py** - TestRelativePathOptimization, TestAbsolutePathBackwardCompatibility, TestPathLengthReduction, TestWindowsCrossDrive, TestSymlinkHandling, TestPathSeparatorNormalization, TestExistingScannerBehavior. Tests Windows path length optimization (Issue #8): verifies relative path usage reduces path lengths, maintains backward compatibility with absolute paths, handles cross-drive scenarios, symlink resolution, and cross-platform path separator normalization.

---

## Recent Changes

**test_cli_scan_defaults_bdd.py**: New BDD test suite for CLI scan default behavior (Epic 19 Story 19.1). Tests the reversed scan defaults where structural mode (SmartWriter) is the default and AI is opt-in via --ai flag. Covers scan command scenarios: default structural output without AI, AI invocation with --ai flag, error handling when ai_command is missing, --fallback deprecation warning, --dry-run requiring --ai. Also covers scan-all command scenarios: default SmartWriter processing, AI opt-in for all directories, --fallback deprecation. Uses Click CliRunner, pytest_bdd scenarios from features/cli_scan_defaults.feature, and InProjectDir context manager for project directory isolation.

**test_init_wizard_bdd.py**: Enhanced ai_command_set step function to properly generate config files before validation. Now imports and calls generate_config_yaml from init_wizard module, applies wizard user choices (configure_ai, ai_tool selection for claude/chatgpt) to the wizard result before generating config YAML, and writes the config file if it doesn't exist. Ensures Config.load can find and validate the ai_command value.

**test_python_inheritance.py, test_java_inheritance.py, test_php_inheritance.py**: Migrated to auto-generated template system (test_generator/specs/*.yaml + Jinja2 templates). Key changes: standardized test structure with consistent `code`/`test_file` variable naming, replaced direct `inh` variable access with filtered list comprehension pattern (`[inh for inh in result.inheritances if inh.child == "X"]`), removed Epic/AC reference numbers from docstrings, added "DO NOT EDIT MANUALLY" headers. New test classes added: TestAdvancedInheritance (Python: ABC, dataclass, enum, exception hierarchy, mixins, diamond, Protocol, metaclass, decorators), TestAdvancedJavaInheritance (Java: diamond, sealed class, wildcard extends, multiple interface extends), TestPHPInheritanceAdvanced (PHP: interface extends, traits, constructor inheritance, multiple interfaces+extends, readonly class, enum implements).

**test_help_system_bdd.py**: BDD test suite for Enhanced Help System (Story 15.3). Implements comprehensive test coverage for help command functionality including parameter descriptions, range validation, structured output formatting, terminal readability checks, configuration examples, and YAML syntax validation.
